<!-- src/components/FileBrowser.vue -->

<template>
  <div class="file-browser-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1 class="page-title">ğŸ“ æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h1>
      <p class="page-desc">ç®¡ç†æ‚¨çš„æ‰€æœ‰æ–‡ä»¶ä¸æ–‡ä»¶å¤¹ï¼Œæ”¯æŒä¸Šä¼ ã€ä¸‹è½½ã€é‡å‘½åã€æ‹–æ‹½ç§»åŠ¨ç­‰æ“ä½œ</p>
    </div>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb-container">
      <el-breadcrumb :separator-icon="ArrowRight" class="custom-breadcrumb">
        <el-breadcrumb-item
          v-for="(part, index) in breadcrumb"
          :key="index"
          @click="navigateTo(part.path)"
          class="breadcrumb-item"
        >
          {{ part.name || 'æ ¹ç›®å½•' }}
        </el-breadcrumb-item>
      </el-breadcrumb>
    </div>

    <!-- å·¥å…·æ  -->
    <div class="toolbar-container">
      <div class="actions-toolbar">
        <div class="primary-actions">
          <el-button
            type="primary"
            @click="showCreateFolderDialog"
            size="default"
            class="action-btn create-folder-btn"
          >
            <Folder class="icon" />
            <span>æ–°å»ºæ–‡ä»¶å¤¹</span>
          </el-button>
          <el-button
            type="success"
            @click="showCreateFileDialog"
            size="default"
            class="action-btn create-file-btn"
          >
            <DocumentAdd class="icon" />
            <span>æ–°å»ºæ–‡ä»¶</span>
          </el-button>
        </div>
        <div class="secondary-actions">
          <el-upload
            :show-file-list="false"
            :http-request="handleUpload"
            :before-upload="beforeUpload"
            class="upload-wrapper"
          >
            <el-button type="primary" size="default" class="action-btn upload-btn">
              <Upload class="icon" />
              <span>ä¸Šä¼ æ–‡ä»¶</span>
            </el-button>
          </el-upload>
        </div>
      </div>
    </div>

    <!-- æ–‡ä»¶åˆ—è¡¨å®¹å™¨ -->
    <div class="file-table-container">
      <el-table
        :data="fileList"
        class="file-table"
        v-loading="loading"
        row-key="path"
        border
        :default-sort="{ prop: 'name', order: 'ascending' }"
      >
        <el-table-column prop="name" label="åç§°" width="320" sortable>
          <template #default="{ row }">
            <div
              @click="handleClick(row)"
              @contextmenu.prevent="showContextMenu($event, row)"
              class="file-name cursor-pointer"
              draggable="true"
              @dragstart="handleDragStart($event, row)"
              @dragover.prevent="handleDragOver($event, row)"
              @drop="handleDrop($event, row)"
              @dragenter="handleDragEnter($event, row)"
              @dragleave="handleDragLeave($event, row)"
            >
              <component :is="row.directory ? Folder : Document" class="file-icon" />
              {{ row.name }}
              <div
                v-if="dragState.isDragging && dragState.targetPath === row.path"
                class="drop-indicator"
              >
                <div class="drop-arrow">â†“</div>
              </div>
            </div>
          </template>
        </el-table-column>
        <el-table-column prop="type" label="ç±»å‹" width="140" />
        <el-table-column prop="size" label="å¤§å°" width="120" sortable>
          <template #default="{ row }">
            {{ formatSize(row.size) }}
          </template>
        </el-table-column>
        <el-table-column prop="createdTime" label="åˆ›å»ºæ—¶é—´" width="180" sortable>
          <template #default="{ row }">
            {{ formatDate(row.createdTime) }}
          </template>
        </el-table-column>
        <el-table-column prop="lastModified" label="ä¿®æ”¹æ—¶é—´" width="180" sortable>
          <template #default="{ row }">
            {{ formatDate(row.lastModified) }}
          </template>
        </el-table-column>
      </el-table>
    </div>

    <!-- å¯¹è¯æ¡†ä»¬ -->
    <!-- æ–°å»ºæ–‡ä»¶å¤¹å¯¹è¯æ¡† -->
    <el-dialog v-model="dialog.folderVisible" title="ğŸ“‚ æ–°å»ºæ–‡ä»¶å¤¹" width="30%">
      <el-form :model="dialog.form" label-width="80px">
        <el-form-item label="æ–‡ä»¶å¤¹å">
          <el-input v-model="dialog.form.name" placeholder="è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°" autofocus />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="dialog.folderVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="confirmCreateFolder">ç¡®å®š</el-button>
      </template>
    </el-dialog>

    <!-- æ–°å»ºæ–‡ä»¶å¯¹è¯æ¡† -->
    <el-dialog v-model="dialog.fileVisible" title="ğŸ“„ æ–°å»ºæ–‡ä»¶" width="30%">
      <el-form :model="dialog.form" label-width="80px">
        <el-form-item label="æ–‡ä»¶å">
          <el-input v-model="dialog.form.name" placeholder="ä¾‹å¦‚ï¼šreadme.txt" autofocus />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="dialog.fileVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="confirmCreateFile">ç¡®å®š</el-button>
      </template>
    </el-dialog>

    <!-- é‡å‘½åå¯¹è¯æ¡† -->
    <el-dialog v-model="dialog.renameVisible" title="âœï¸ é‡å‘½å" width="30%">
      <el-form :model="dialog.form" label-width="80px">
        <el-form-item label="æ–°åç§°">
          <el-input v-model="dialog.form.newName" :placeholder="`è¯·è¾“å…¥æ–°åç§°`" autofocus />
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="dialog.renameVisible = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="confirmRename">ç¡®å®š</el-button>
      </template>
    </el-dialog>
  </div>

  <!-- å±æ€§å¯¹è¯æ¡† -->
  <el-dialog
    v-model="propertiesDialog.visible"
    title="ğŸ“„ æ–‡ä»¶å±æ€§"
    width="400px"
    :close-on-click-modal="false"
  >
    <div v-if="propertiesDialog.item" class="properties-content">
      <div class="prop-item">
        <label>åç§°ï¼š</label>
        <span>{{ propertiesDialog.item.name }}</span>
      </div>
      <div class="prop-item">
        <label>è·¯å¾„ï¼š</label>
        <span class="path-text">{{ propertiesDialog.item.path }}</span>
      </div>
      <div class="prop-item">
        <label>ç±»å‹ï¼š</label>
        <span>{{ propertiesDialog.item.directory ? 'æ–‡ä»¶å¤¹' : propertiesDialog.item.type }}</span>
      </div>
      <div class="prop-item" v-if="!propertiesDialog.item.directory">
        <label>å¤§å°ï¼š</label>
        <span>{{ formatSize(propertiesDialog.item.size) }}</span>
      </div>
      <div class="prop-item">
        <label>ä¿®æ”¹æ—¶é—´ï¼š</label>
        <span>{{ formatDate(propertiesDialog.item.lastModified) }}</span>
      </div>
      <div class="prop-item">
        <label>åˆ›å»ºæ—¶é—´ï¼š</label>
        <span>{{ formatDate(propertiesDialog.item.lastModified) }}</span>
        <!-- å¦‚æœ‰çœŸå®åˆ›å»ºæ—¶é—´å¯æ›¿æ¢ -->
      </div>
    </div>
    <template #footer>
      <el-button @click="propertiesDialog.visible = false" type="primary">å…³é—­</el-button>
    </template>
  </el-dialog>

  <!-- å³é”®èœå• -->
  <div
    v-if="contextMenu.visible"
    class="context-menu"
    :style="{ left: contextMenu.x + 'px', top: contextMenu.y + 'px' }"
    ref="contextMenuRef"
  >
    <div class="context-menu-item" @click="handleOpen" v-if="contextMenu.target?.directory">
      <FolderOpened class="menu-icon" />
      æ‰“å¼€
    </div>
    <div class="context-menu-item" @click="handleDownload" v-else>
      <Download class="menu-icon" />
      ä¸‹è½½
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" @click="handleRename">
      <Edit class="menu-icon" />
      é‡å‘½å
    </div>
    <div class="context-menu-item" @click="handleProperties">
      <InfoFilled class="menu-icon" />
      å±æ€§
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item danger" @click="handleDelete">
      <Delete class="menu-icon" />
      åˆ é™¤
    </div>
  </div>
</template>

<script setup lang="ts">
  import fileApi from '@/api/fileApi';
  import type { FileItem } from '@/types/FileItem';
  import {
    ArrowRight,
    Delete,
    Document,
    DocumentAdd,
    Download,
    Edit,
    Folder,
    FolderOpened,
    InfoFilled,
    Upload,
  } from '@element-plus/icons-vue';
  import { onClickOutside, onKeyStroke } from '@vueuse/core';
  import { ElMessage, ElMessageBox } from 'element-plus';
  import { computed, onMounted, ref } from 'vue';

  // ======== å³é”®èœå•é€»è¾‘ =========

  // å³é”®èœå•çŠ¶æ€
  const contextMenu = ref({
    visible: false,
    x: 0,
    y: 0,
    target: null as FileItem | null,
  });

  const contextMenuRef = ref<HTMLElement | null>(null);

  // æ˜¾ç¤ºå³é”®èœå•
  const showContextMenu = (e: MouseEvent, item: FileItem) => {
    e.preventDefault();
    contextMenu.value.target = item;
    // è®¡ç®—èœå•ä½ç½®ï¼ˆé˜²æ­¢è¶…å‡ºè§†å£ï¼‰
    const menuWidth = 200;
    const menuHeight = 220; // èœå•é«˜åº¦å¢åŠ ï¼Œå› ä¸ºå¢åŠ äº†æ›´å¤šé€‰é¡¹
    const x = e.clientX + menuWidth > window.innerWidth ? e.clientX - menuWidth : e.clientX;
    const y = e.clientY + menuHeight > window.innerHeight ? e.clientY - menuHeight : e.clientY;
    contextMenu.value.x = x;
    contextMenu.value.y = y;
    contextMenu.value.visible = true;
  };

  // éšè—èœå•
  const hideContextMenu = () => {
    contextMenu.value.visible = false;
  };

  // ç›‘å¬ç‚¹å‡»å¤–éƒ¨å…³é—­
  onClickOutside(
    contextMenuRef, // æˆ‘ä»¬ç¨åç»‘å®šåˆ°èœå•å®¹å™¨
    () => {
      hideContextMenu();
    },
  );

  // ç›‘å¬ ESC é”®
  onKeyStroke('Escape', () => {
    hideContextMenu();
  });

  // èœå•æ“ä½œ
  const handleOpen = () => {
    const item = contextMenu.value.target;
    if (!item) return;
    hideContextMenu();
    if (item.directory) {
      loadFiles(item.path);
    }
  };

  const handleDownload = () => {
    const item = contextMenu.value.target;
    if (!item) return;
    hideContextMenu();
    if (!item.directory) {
      fileApi.downloadFile(item.path);
    }
  };

  const handleRename = () => {
    const item = contextMenu.value.target;
    if (!item) return;
    hideContextMenu();
    renameFileAction(item);
  };

  const handleDelete = () => {
    const item = contextMenu.value.target;
    if (!item) return;
    hideContextMenu();
    deleteFileAction(item);
  };

  const handleProperties = () => {
    const item = contextMenu.value.target;
    if (!item) return;
    hideContextMenu();
    showProperties(item);
  };

  // å±æ€§å¼¹çª—
  const propertiesDialog = ref({
    visible: false,
    item: null as FileItem | null,
  });

  const showProperties = (item: FileItem) => {
    propertiesDialog.value.item = item;
    propertiesDialog.value.visible = true;
  };

  // æ‹–æ‹½çŠ¶æ€
  const dragState = ref({
    isDragging: false,
    draggedItem: null as FileItem | null,
    targetPath: '',
    dragOverItem: null as FileItem | null,
  });

  // å¤„ç†æ‹–æ‹½å¼€å§‹
  const handleDragStart = (event: DragEvent, item: FileItem) => {
    if (event.dataTransfer) {
      event.dataTransfer.effectAllowed = 'move';
      event.dataTransfer.setData('text/plain', item.path);
      dragState.value.draggedItem = item;
      dragState.value.isDragging = true;
      // è®¾ç½®æ‹–æ‹½å›¾æ ‡
      const img = new Image();
      img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
      event.dataTransfer.setDragImage(img, 0, 0);
    }
  };

  // å¤„ç†æ‹–æ‹½ç»è¿‡
  const handleDragOver = (event: DragEvent, item: FileItem) => {
    event.preventDefault();
    if (event.dataTransfer) {
      event.dataTransfer.dropEffect = 'move';
    }

    // åªå…è®¸æ‹–æ‹½åˆ°æ–‡ä»¶å¤¹
    if (!item.directory) {
      return;
    }

    // æ›´æ–°æ‹–æ‹½ç›®æ ‡
    dragState.value.targetPath = item.path;
    dragState.value.dragOverItem = item;
  };

  // å¤„ç†æ‹–æ‹½è¿›å…¥
  const handleDragEnter = (event: DragEvent, item: FileItem) => {
    event.preventDefault();
    // åªå…è®¸æ‹–æ‹½åˆ°æ–‡ä»¶å¤¹
    if (!item.directory) {
      return;
    }
  };

  // å¤„ç†æ‹–æ‹½ç¦»å¼€
  const handleDragLeave = (event: DragEvent, item: FileItem) => {
    // æ¸…é™¤ç›®æ ‡è·¯å¾„
    if (dragState.value.targetPath === item.path) {
      dragState.value.targetPath = '';
      dragState.value.dragOverItem = null;
    }
  };

  // å¤„ç†æ‹–æ‹½é‡Šæ”¾
  const handleDrop = async (event: DragEvent, targetItem: FileItem) => {
    event.preventDefault();

    // åªå…è®¸æ‹–æ‹½åˆ°æ–‡ä»¶å¤¹
    if (!targetItem.directory) {
      ElMessage.warning('åªèƒ½æ‹–æ‹½åˆ°æ–‡ä»¶å¤¹å†…');
      dragState.value.isDragging = false;
      dragState.value.targetPath = '';
      dragState.value.dragOverItem = null;
      return;
    }

    const draggedItem = dragState.value.draggedItem;
    if (!draggedItem) {
      dragState.value.isDragging = false;
      dragState.value.targetPath = '';
      dragState.value.dragOverItem = null;
      return;
    }

    // ä¸èƒ½æ‹–æ‹½åˆ°è‡ªèº«æˆ–è‡ªèº«å­ç›®å½•
    if (
      draggedItem.path === targetItem.path ||
      targetItem.path.startsWith(draggedItem.path + '/')
    ) {
      ElMessage.warning('ä¸èƒ½å°†æ–‡ä»¶å¤¹æ‹–æ‹½åˆ°è‡ªèº«æˆ–å…¶å­ç›®å½•ä¸­');
      dragState.value.isDragging = false;
      dragState.value.targetPath = '';
      dragState.value.dragOverItem = null;
      return;
    }

    // æ„å»ºç›®æ ‡è·¯å¾„
    const fileName = draggedItem.name;
    const targetPath = targetItem.path + '/' + fileName;

    try {
      await fileApi.moveFile(draggedItem.path, targetPath);
      ElMessage.success('ç§»åŠ¨æˆåŠŸ');
      await loadFiles(currentPath.value);
    } catch (error) {
      ElMessage.error('ç§»åŠ¨å¤±è´¥ï¼š' + (error as any).message);
    } finally {
      dragState.value.isDragging = false;
      dragState.value.targetPath = '';
      dragState.value.dragOverItem = null;
    }
  };

  const currentPath = ref('');
  const fileList = ref<FileItem[]>([]);
  const loading = ref(false);

  // é¢åŒ…å±‘
  const breadcrumb = computed(() => {
    const parts = currentPath.value.split('/').filter(Boolean);
    const crumbs = [{ name: '', path: '' }];
    let path = '';
    parts.forEach((part, index) => {
      path += (index > 0 ? '/' : '') + part;
      crumbs.push({
        name: part,
        path: path,
      });
    });
    return crumbs;
  });

  // å¯¹è¯æ¡†çŠ¶æ€
  const dialog = ref({
    folderVisible: false,
    fileVisible: false,
    renameVisible: false,
    form: {
      name: '',
      newName: '',
      currentFile: null as FileItem | null,
    },
  });

  // åŠ è½½å½“å‰ç›®å½•
  const loadFiles = async (path = '') => {
    loading.value = true;
    try {
      currentPath.value = path;
      fileList.value = await fileApi.getFileList(path);
    } catch (error) {
      console.log(error);
      ElMessage.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');
    } finally {
      loading.value = false;
    }
  };

  // å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„
  const navigateTo = (path: string) => {
    loadFiles(path);
  };

  // ç‚¹å‡»æ–‡ä»¶/æ–‡ä»¶å¤¹
  const handleClick = (row: FileItem) => {
    if (row.directory) {
      loadFiles(row.path);
    } else {
      // å¯é¢„è§ˆæˆ–ç›´æ¥ä¸‹è½½
      fileApi.downloadFile(row.path);
    }
  };

  // æ ¼å¼åŒ–å¤§å°
  const formatSize = (bytes: number): string => {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  };

  // æ ¼å¼åŒ–æ—¥æœŸ
  const formatDate = (timestamp: number): string => {
    return new Date(timestamp).toLocaleString();
  };

  // æ–°å»ºæ–‡ä»¶å¤¹
  const showCreateFolderDialog = () => {
    dialog.value.form.name = '';
    dialog.value.folderVisible = true;
  };

  const confirmCreateFolder = async () => {
    if (!dialog.value.form.name.trim()) {
      ElMessage.warning('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°');
      return;
    }
    try {
      const newPath = currentPath.value
        ? `${currentPath.value}/${dialog.value.form.name}`
        : dialog.value.form.name;
      await fileApi.createDirectory(newPath);
      ElMessage.success('æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸ');
      dialog.value.folderVisible = false;
      await loadFiles(currentPath.value); // åˆ·æ–°
    } catch (error) {
      ElMessage.error('åˆ›å»ºå¤±è´¥ï¼š' + (error as any).message);
    }
  };

  // æ–°å»ºæ–‡ä»¶
  const showCreateFileDialog = () => {
    dialog.value.form.name = '';
    dialog.value.fileVisible = true;
  };

  const confirmCreateFile = async () => {
    if (!dialog.value.form.name.trim()) {
      ElMessage.warning('è¯·è¾“å…¥æ–‡ä»¶å');
      return;
    }
    try {
      const newPath = currentPath.value
        ? `${currentPath.value}/${dialog.value.form.name}`
        : dialog.value.form.name;
      await fileApi.createFile(newPath);
      ElMessage.success('æ–‡ä»¶åˆ›å»ºæˆåŠŸ');
      dialog.value.fileVisible = false;
      await loadFiles(currentPath.value);
    } catch (error) {
      ElMessage.error('åˆ›å»ºå¤±è´¥ï¼š' + (error as any).message);
    }
  };

  // ä¸Šä¼ å‰æ£€æŸ¥
  const beforeUpload = (rawFile: File) => {
    if (!rawFile.name) {
      ElMessage.error('æ–‡ä»¶åæ— æ•ˆ');
      return false;
    }
    return true;
  };

  // è‡ªå®šä¹‰ä¸Šä¼ å¤„ç†
  const handleUpload = async (options: any) => {
    const { file } = options;
    try {
      const uploadPath = currentPath.value ? `${currentPath.value}/${file.name}` : file.name;
      await fileApi.uploadFile(uploadPath, file);
      ElMessage.success('ä¸Šä¼ æˆåŠŸ');
      await loadFiles(currentPath.value);
    } catch (error) {
      console.log(error);
      ElMessage.error('ä¸Šä¼ å¤±è´¥ï¼š' + (error as any).message);
    }
  };

  // é‡å‘½å
  const renameFileAction = (row: FileItem) => {
    dialog.value.form.newName = row.name;
    dialog.value.form.currentFile = row;
    dialog.value.renameVisible = true;
  };

  const confirmRename = async () => {
    if (!dialog.value.form.newName.trim()) {
      ElMessage.warning('è¯·è¾“å…¥æ–°åç§°');
      return;
    }
    const oldPath = dialog.value.form.currentFile!.path;
    const oldDir = oldPath.substring(0, oldPath.lastIndexOf('/') + 1);
    const newPath = oldDir + dialog.value.form.newName;

    try {
      await fileApi.renameFile(oldPath, newPath);
      ElMessage.success('é‡å‘½åæˆåŠŸ');
      dialog.value.renameVisible = false;
      await loadFiles(currentPath.value);
    } catch (error) {
      ElMessage.error('é‡å‘½åå¤±è´¥ï¼š' + (error as any).message);
    }
  };

  // åˆ é™¤
  const deleteFileAction = (row: FileItem) => {
    ElMessageBox.confirm(`ç¡®å®šåˆ é™¤ "${row.name}" å—ï¼Ÿ`, 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning',
    }).then(async () => {
      try {
        await fileApi.deleteFile(row.path);
        ElMessage.success('åˆ é™¤æˆåŠŸ');
        await loadFiles(currentPath.value);
      } catch (error) {
        ElMessage.error('åˆ é™¤å¤±è´¥ï¼š' + (error as any).message);
      }
    });
  };

  // åˆå§‹åŒ–åŠ è½½æ ¹ç›®å½•
  onMounted(() => {
    loadFiles('');
  });
</script>

<style scoped>
  .file-browser-page {
    padding: 24px 32px;
    background-color: #f8fafc;
    min-height: 100vh;
  }

  /* é¡µé¢æ ‡é¢˜ */
  .page-title {
    font-size: 28px;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 8px 0;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .page-desc {
    font-size: 14px;
    color: #64748b;
    margin: 0 0 24px 0;
  }

  /* é¢åŒ…å±‘ */
  .breadcrumb-container {
    margin-bottom: 24px;
  }

  .custom-breadcrumb :deep(.el-breadcrumb__item) {
    font-size: 14px;
  }

  .breadcrumb-item {
    cursor: pointer;
    color: #3b82f6;
    transition: color 0.2s;
  }

  .breadcrumb-item:hover {
    color: #1d4ed8;
    text-decoration: underline;
  }

  /* å·¥å…·æ  - é‡æ–°è®¾è®¡å¸ƒå±€ */
  .toolbar-container {
    margin-bottom: 24px;
  }

  .actions-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  .primary-actions {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .secondary-actions {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .action-btn {
    border-radius: 8px;
    font-weight: 500;
    font-size: 15px;
    padding: 12px 20px;
    height: auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    min-width: 120px;
    text-align: center;
  }

  .action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .action-btn:active {
    transform: translateY(0);
  }

  .action-btn .icon {
    width: 18px;
    height: 18px;
    margin-right: 8px;
    vertical-align: middle;
  }

  /* ä¸åŒç±»å‹çš„æŒ‰é’®æ ·å¼ */
  .create-folder-btn {
    background-color: #3b82f6;
    border-color: #3b82f6;
    color: white;
  }

  .create-folder-btn:hover {
    background-color: #2563eb;
    border-color: #2563eb;
  }

  .create-file-btn {
    background-color: #10b981;
    border-color: #10b981;
    color: white;
  }

  .create-file-btn:hover {
    background-color: #059669;
    border-color: #059669;
  }

  .upload-btn {
    background-color: #6366f1;
    border-color: #6366f1;
    color: white;
  }

  .upload-btn:hover {
    background-color: #4f46e5;
    border-color: #4f46e5;
  }

  /* æ–‡ä»¶è¡¨æ ¼å®¹å™¨ */
  .file-table-container {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    padding: 20px;
  }

  .file-table :deep(.el-table) {
    font-size: 14px;
  }

  .file-table :deep(.el-table th) {
    background-color: #f8fafc;
    font-weight: 600;
    color: #334155;
  }

  /* æ–‡ä»¶åæ ·å¼ */
  .file-name {
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #1e293b;
    font-weight: 500;
    transition: all 0.2s ease;
    position: relative;
    padding: 8px 0;
  }

  .file-name:hover {
    color: #3b82f6;
    text-decoration: underline;
    transform: scale(1.02);
  }

  .file-icon {
    width: 18px;
    height: 18px;
    color: #64748b;
  }

  .file-name:hover .file-icon {
    color: #3b82f6;
  }

  /* æ‹–æ‹½æ•ˆæœ */
  .file-name[draggable='true'] {
    cursor: grab;
  }

  .file-name[draggable='true']:active {
    cursor: grabbing;
  }

  /* æ‹–æ‹½ç›®æ ‡é«˜äº® */
  .file-name.drag-over {
    background-color: #dbeafe;
    border-radius: 4px;
  }

  /* æ‹–æ‹½æŒ‡ç¤ºå™¨ */
  .drop-indicator {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    color: #3b82f6;
    font-weight: bold;
    font-size: 18px;
    animation: bounce 0.6s infinite;
  }

  @keyframes bounce {
    0%,
    100% {
      transform: translateY(-50%) scale(1);
    }
    50% {
      transform: translateY(-50%) scale(1.2);
    }
  }

  /* ========== å³é”®èœå•æ ·å¼ ========== */
  .context-menu {
    position: fixed;
    z-index: 2000;
    background: #fff;
    border: 1px solid #ebeef5;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    padding: 8px 0;
    min-width: 180px;
    font-size: 15px;
  }

  /* å³é”®èœå•é¡¹ */
  .context-menu-item {
    display: flex;
    align-items: center;
    padding: 12px 18px;
    color: #475569;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 6px;
    margin: 0 4px;
  }

  .context-menu-item:hover {
    background-color: #f1f5f9;
    color: #3b82f6;
  }

  .context-menu-item.danger:hover {
    color: #ef4444;
    background-color: #fee2e2;
  }

  .menu-icon {
    width: 18px;
    height: 18px;
    margin-right: 12px;
    color: inherit;
  }

  .context-menu-divider {
    height: 1px;
    background-color: #e2e8f0;
    margin: 6px 0;
  }

  /* å±æ€§å¯¹è¯æ¡†æ ·å¼ */
  .properties-content {
    padding: 16px;
    line-height: 2;
  }

  .prop-item label {
    font-weight: 600;
    color: #333;
    width: 80px;
    display: inline-block;
  }

  .path-text {
    word-break: break-all;
    font-family: monospace;
    background: #f8f9fa;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    user-select: all;
    transition: background 0.2s;
  }

  .path-text:hover {
    background: #e9ecef;
    text-decoration: underline;
  }

  /* å“åº”å¼é€‚é… */
  @media (max-width: 768px) {
    .file-browser-page {
      padding: 16px;
    }

    .page-title {
      font-size: 24px;
    }

    .actions-toolbar {
      flex-direction: column;
      align-items: stretch;
    }

    .primary-actions,
    .secondary-actions {
      width: 100%;
      justify-content: center;
    }

    /* å·¥å…·æ æŒ‰é’® */
    .action-btn {
      border-radius: 8px;
      font-weight: 600;
      font-size: 15px;
      padding: 12px 20px;
      transition: all 0.25s ease;
      min-width: 140px;
    }

    .action-btn .icon {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      vertical-align: middle;
    }

    /* æ‚¬åœæ•ˆæœå¢å¼º */
    .action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .file-table :deep(.el-table) {
      font-size: 13px;
    }

    .file-table :deep(.el-table th),
    .file-table :deep(.el-table td) {
      padding: 8px 4px;
    }

    /* ç§»åŠ¨ç«¯å³é”®èœå• */
    .context-menu {
      font-size: 16px;
      min-width: 200px;
    }

    .context-menu-item {
      padding: 14px 20px;
    }

    .file-name {
      padding: 6px 0;
    }
  }
</style>
